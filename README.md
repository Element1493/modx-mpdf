# modxMpdf
Данное дополнение преобразует ресурсы в файлы PDF с помощью mPDF.

## Документация
Внимание! Документация в режиме беты, тексты могут содержать опечатки
1. [Инструкция](#инструкция)
	1. [Создание PDF-файл](#создание-pdf-файл)
	2. [Создание PDF-файл на лету](#создание-pdf-файл-на-лету)
	3. [Параметры PDF](#параметры-pdf)
	4. [Шаблон содержимого PDF](#шаблон-содержимого-pdf)
	4. [Шифрование PDF паролем](#шифрование-pdf-паролем)
	5. [Ссылка на сгенерированный PDF-файл](#ссылка-на-сгенерированный-pdf-файл)
	6. [Отобразить PDF-файл на странице](#отобразить-pdf-файл-на-странице)
2. [Системные настройки](#системные-настройки)
3. [Инструкция](#инструкция)


## Инструкция
### Создание PDF-файл
Для того чтобы создавался PDF-файл, необходимо создать новое *Дополнительное поле (TV) - `pdf_create` по умолчанию, если вам нужно другое название переменной, для этого поменяйте в **Системных настройка** параметр `mpdf.tvPDF` на любое.

Если вы хотите сохранить PDF-файл в другом месте, то в **Системных настройка** -> `mpdf.pdfPath` и `mpdf.pdfUrl` измените путь к PDF.

После этого при каждом сохранение ресурса будет создаваться PDF-файл по умолчанию `assets/pdf` или прописано вами путь.

***Дополнительное поле (TV) - `pdf_create`**

|Название|Тип ввода|Возможные значения|
|-|-|-|
|pdf_create|Флажки (checkbox)|Да==1|

____

### Создание PDF-файл на лету

Для того чтобы сгенерировать PDF-файлы на лету, необходимо создать новое *Дополнительное поле (TV) - `pdf_live` по умолчанию, если вам нужно другое название переменной, для этого поменяйте в **Системных настройка** параметр `mpdf.tvPDFlive` на любое.

> :warning: **ВНИМАНИЕ:**
> Использование данной опций приведёт к нагрузке на Хостинг, также генерирование PDF-файлы может занять продолжительное время.

***Дополнительное поле (TV) - `pdf_live`**

|Название|Тип ввода|Возможные значения|
|-|-|-|
|ppdf_live|Флажки (checkbox)|Да==1|

____

### Параметры PDF-файла

Некоторые параметры можно изменить в **Системных настройка**, однако есть возможность создать для каждого ресурса индивидуальные параметры, для этого вам необходимо создать новое *Дополнительное поле (TV) - `pdf_options` по умолчанию, если вам нужно другое название переменной, для этого поменяйте в **Системных настройка** параметр `mpdf.tvPDFoptions` на любое.

Данный параметры должный быть записаны виде кодировки JSON, пример:

```JSON
{
    "mode" : "utf-8",
    "format" : [190, 236],
    "orientation" : "L"
}
```

***Дополнительное поле (TV) - `pdf_options`**

|Название|Тип ввода|
|-|-|
|pdf_options|Текстовая область|

____

### Шаблон содержимого PDF

Перед оформление обязательно ознакомитесь с руководством:
* [HTML-теги](https://mpdf.github.io/html-support/html-tags.html)
* [Атрибуты HTML](https://mpdf.github.io/html-support/html-attributes.html)

После установки будут созданы чанки: 

* `tpl.pdf.header` - верхний колонтитул*
* `tpl.pdf` - содержимое
* `tpl.pdf.footer` - нижний колонтитул*

>**Номер страницы** и **Дата**
>Для чанков `tpl.pdf.header` и `tpl.pdf.footer` предусмотрены псевдонимы:
> * `{PAGENO}` - выводить номер страницы;
> * `{DATE j-m-Y}` - выводить текущую дату.
>
> Также существуют несколько [псевдонимов](https://mpdf.github.io/what-else-can-i-do/replaceable-aliases.html).
____ 

### Защитить PDF-файл

Для защиты файлы также возможно зашифровать паролем, для этого достаточно указать в **Системных настройка** пароль администратора и пользователя, а также указать права доступа.

По умолчанию PDF-файл сгенерируется полностью зашифрованным для пользователя, чтобы разрешить пользователю выполнять определённые действия в **Системных настройка** -> `mpdf.permissions` записываем значение в массив виде кодировки JSON, пример:

```JSON
["copy", "print"]
```

|Значения|Описание|
|-|-|
|copy|Разрешить копирование содержимого|
|print|Разрешить печать документа|
|print-highres|Разрешить печать документ в высоком качестве|
|modify|Разрешить изменять документ|
|annot-forms|Разрешить добавление или изменение текстовых аннотаций|
|fill-forms|Разрешить заполнение существующих полей интерактивной формы|
|extract|Разрешить извлекать из документа текст и изображение|
|assemble|Разрешить собирать документ|

____

### Ссылка на сгенерированный PDF-файл

Для получение ссылки на сгенерированный PDF-файл, вы можете использовать как сниппет или если у вас включён fenom - модификатор.

* ```{12|mPDFLink}```
* ```[[!mPDF? &input=`12`]]```
____

### Отобразить PDF-файл на странице

* ```[[!mPDF? &live=`1`]]```
____

## Системные настройки

|Ключ|Название|По умолчанию|
|-|-|-|
|mpdf.configuration|Конфигурация mPDF| |
|mpdf.defaultFont|Шрифт документа PDF по умолчанию| |
|mpdf.defaultFontSize|Размер шрифта документа PDF по умолчанию|8|
|mpdf.fontData|Имена шрифтов| |
|mpdf.fontDirs|Каталог шрифтов| |
|mpdf.format|Формат документа PDF|A4|
|mpdf.marginBottom|Отступ от нижнего края|7|
|mpdf.marginFooter|Отступ Footer от нижнего края|10|
|mpdf.marginHeader|Отступ Header от верхнего края|10|
|mpdf.marginLeft|Отступ от левого края|10|
|mpdf.marginRight|Отступ от правого края|10|
|mpdf.marginTop|Отступ от верхнего края|7|
|mpdf.mode|Режим документа PDF|utf-8|
|mpdf.orientation|Ориентация PDF|P|
|mpdf.author|Автор PDF| |
|mpdf.creator|Создатель PDF| |
|mpdf.title|Заголовок PDF| |
|mpdf.processTVs|Вывести обработанные TV|Нет|
|mpdf.tvPDF|Имя TV параметра c создание PDF|pdf_create|
|mpdf.tvPDFlive|Имя TV параметра c создание PDF на лету|pdf_live|
|mpdf.tvPDFoptions|Имя TV параметра c параметрами mPDF|pdf_options|
|mpdf.tvPrefix|Префикс для TV плейсхолдеров|tv_|
|mpdf.ownerPassword|Пароль администратора| |
|mpdf.permissions|Список Права доступа| |
|mpdf.userPassword|Пароль пользователя| |
|mpdf.pdfCSS|Путь к CSS файл| |
|mpdf.pdfPath|Абсолютный путь к PDF|{assets_path}pdf/|
|mpdf.pdfUrl|Относительный путь к PDF|{assets_url}pdf/|
|mpdf.tpl|Имя чанка для HTML|tpl.pdf|
|mpdf.tplFooter|Имя чанка для Footer|tpl.pdf.footer|
|mpdf.tplHeader|Имя чанка для Header|tpl.pdf.header|



